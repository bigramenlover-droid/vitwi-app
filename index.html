<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Vitwi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="header">
            <div class="header-top">
                <div class="header-content">
                    <h1>Vitwi</h1>
                    <p class="subtitle">–†–∞—Å–ø–æ–∑–Ω–∞–π —Ä–µ—Ü–µ–ø—Ç –∏ –ø–æ–ª—É—á–∏ –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª—é–¥–µ</p>
                </div>
                <button class="theme-toggle-btn" id="theme-toggle" title="–ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                    <span class="theme-icon">üé®</span>
                </button>
            </div>
        </header>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã -->
        <div id="theme-modal" class="theme-modal hidden">
            <div class="theme-modal-overlay"></div>
            <div class="theme-modal-content">
                <div class="theme-modal-header">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</h3>
                    <button class="theme-modal-close" id="theme-modal-close">‚úï</button>
                </div>
                <div class="themes-grid" id="themes-grid">
                    <!-- –¢–µ–º—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –≤–≤–æ–¥–∞ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="input">‚úçÔ∏è –í–≤–æ–¥ —Ä–µ—Ü–µ–ø—Ç–∞</button>
            <button class="tab-btn" data-tab="vita">ü§ñ –í–∏—Ç–∞</button>
            <button class="tab-btn" data-tab="saved">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ</button>
            <button class="tab-btn" data-tab="cart">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
        </div>

        <!-- –í–≤–æ–¥ —Ä–µ—Ü–µ–ø—Ç–∞ -->
        <div class="tab-content active" id="input-tab">
            <div class="input-section">
                <textarea 
                    id="recipe-input" 
                    class="text-input" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ—Ü–µ–ø—Ç–∞ –∑–¥–µ—Å—å..."
                    rows="8"
                ></textarea>
                <button class="btn btn-primary" id="analyze-recipe">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä–µ—Ü–µ–ø—Ç...</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ -->
            <div id="results" class="results hidden">
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ -->
            <div class="result-card">
                <h2 id="dish-name" class="dish-name"></h2>
                <div class="recipe-meta">
                    <div class="meta-item" id="difficulty-meta">
                        <span class="meta-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</span>
                        <span class="meta-value" id="difficulty-value">-</span>
                    </div>
                    <div class="meta-item" id="time-meta">
                        <span class="meta-label">–í—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏:</span>
                        <span class="meta-value" id="time-value">-</span>
                    </div>
                </div>
            </div>

            <!-- –ë–ñ–£ –∏ –∫–∞–ª–æ—Ä–∏–∏ -->
            <div class="nutrition-card">
                <h3>üìä –ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å</h3>
                
                <!-- –ù–∞ 100 –≥—Ä–∞–º–º -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title">–ù–∞ 100 –≥—Ä–∞–º–º:</h4>
                    <div class="nutrition-grid">
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="calories-100g">-</div>
                            <div class="nutrition-label">–∫–∫–∞–ª</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="proteins-100g">-</div>
                            <div class="nutrition-label">–ë–µ–ª–∫–∏ (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="fats-100g">-</div>
                            <div class="nutrition-label">–ñ–∏—Ä—ã (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="carbs-100g">-</div>
                            <div class="nutrition-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                        </div>
                    </div>
                </div>

                <!-- –ù–∞ –ø–æ—Ä—Ü–∏—é -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title" id="serving-title">–ù–∞ –ø–æ—Ä—Ü–∏—é:</h4>
                    <div class="nutrition-grid">
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="calories-serving">-</div>
                            <div class="nutrition-label">–∫–∫–∞–ª</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="proteins-serving">-</div>
                            <div class="nutrition-label">–ë–µ–ª–∫–∏ (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="fats-serving">-</div>
                            <div class="nutrition-label">–ñ–∏—Ä—ã (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value" id="carbs-serving">-</div>
                            <div class="nutrition-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->
            <div class="result-card">
                <div class="ingredients-header">
                    <h3>ü•ò –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h3>
                    <button class="btn btn-add-all" id="add-all-ingredients">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
                </div>
                <ul id="ingredients-list" class="ingredients-list"></ul>
            </div>

            <!-- –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
            <div class="result-card">
                <h3>üë®‚Äçüç≥ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
                <div id="instructions" class="instructions"></div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="action-buttons">
                <button class="btn btn-save" id="save-recipe">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
                <button class="btn btn-secondary" id="new-analysis">–ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑</button>
            </div>
            </div>
        </div>

        <!-- –í–∏—Ç–∞ - –ò–ò –∞–≥–µ–Ω—Ç -->
        <div class="tab-content" id="vita-tab">
            <div class="vita-section">
                <div class="vita-header">
                    <div class="vita-avatar" id="vita-avatar-container">
                        <img src="images/vita-avatar.jpg" alt="–í–∏—Ç–∞" class="vita-avatar-img" id="vita-avatar-img" onerror="handleVitaAvatarError()">
                    </div>
                    <div class="vita-info">
                        <h3>–í–∏—Ç–∞</h3>
                        <p class="vita-subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ—Ü–µ–ø—Ç–∞–º</p>
                    </div>
                </div>
                
                <div class="vita-input-section">
                    <textarea 
                        id="vita-query" 
                        class="text-input" 
                        placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å... –ù–∞–ø—Ä–∏–º–µ—Ä: '–õ–µ–≥–∫–∏–π –∑–∞–≤—Ç—Ä–∞–∫ –Ω–∞ 20 –º–∏–Ω—É—Ç —Å –æ–≤–æ—â–∞–º–∏' –∏–ª–∏ '–°—ã—Ç–Ω—ã–π –æ–±–µ–¥ —Å –º—è—Å–æ–º, –≥–æ—Ç–æ–≤–∫–∞ –¥–æ —á–∞—Å–∞'"
                        rows="4"
                    ></textarea>
                    <button class="btn btn-primary" id="vita-ask">–°–ø—Ä–æ—Å–∏—Ç—å –í–∏—Ç—É</button>
                </div>

                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –í–∏—Ç—ã -->
                <div id="vita-loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>–í–∏—Ç–∞ –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Ä–µ—Ü–µ–ø—Ç—ã...</p>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç –í–∏—Ç—ã -->
                <div id="vita-results" class="vita-results hidden"></div>
            </div>
        </div>

        <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
        <div class="tab-content" id="saved-tab">
            <div class="saved-recipes-section">
                <div class="saved-search-container">
                    <input 
                        type="text" 
                        id="tag-search" 
                        class="tag-search-input" 
                        placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º..."
                        autocomplete="off"
                    />
                </div>
                <div id="saved-recipes-list" class="saved-recipes-list">
                    <p class="empty-message">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤</p>
                </div>
            </div>
        </div>

        <!-- –ö–æ—Ä–∑–∏–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
        <div class="tab-content" id="cart-tab">
            <div class="cart-section">
                <div class="cart-header">
                    <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h3>
                    <button class="btn btn-clear" id="clear-cart">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
                </div>
                <div id="cart-list" class="cart-list">
                    <p class="empty-message">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                </div>
            </div>
        </div>

        <!-- –û—à–∏–±–∫–∞ -->
        <div id="error" class="error hidden">
            <p id="error-message"></p>
            <button class="btn btn-secondary" onclick="hideError()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script type="module" src="src/app.js"></script>
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –í–∏—Ç—ã
        function handleVitaAvatarError() {
            const container = document.getElementById('vita-avatar-container');
            const img = document.getElementById('vita-avatar-img');
            
            if (container && img) {
                // –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã
                const formats = ['png', 'jpeg', 'webp'];
                const currentSrc = img.src;
                const basePath = currentSrc.substring(0, currentSrc.lastIndexOf('.'));
                let formatIndex = 0;
                let attempts = 0;
                
                function tryNextFormat() {
                    attempts++;
                    if (formatIndex < formats.length && attempts <= formats.length) {
                        img.src = basePath + '.' + formats[formatIndex];
                        formatIndex++;
                    } else {
                        // –ï—Å–ª–∏ –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏
                        if (img && img.parentNode) {
                            img.style.display = 'none';
                        }
                        container.innerHTML = 'ü§ñ';
                        container.style.fontSize = '48px';
                        container.style.display = 'flex';
                        container.style.alignItems = 'center';
                        container.style.justifyContent = 'center';
                    }
                }
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
                img.onerror = null;
                img.onerror = tryNextFormat;
                tryNextFormat();
            }
        }
    </script>
</body>
</html>

